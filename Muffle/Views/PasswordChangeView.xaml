<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Muffle.ViewModels"
             x:Class="Muffle.Views.PasswordChangeView"
             x:DataType="viewmodels:PasswordChangeViewModel"
             BackgroundColor="#303030">

    <Grid RowDefinitions="Auto,*" Padding="20" RowSpacing="15">

        <!-- Header -->
        <VerticalStackLayout Grid.Row="0" Spacing="6">
            <Label Text="Change Password"
                   FontSize="24"
                   FontAttributes="Bold"
                   TextColor="White"/>
            <Label Text="Verify your identity, then set a new password for your account."
                   FontSize="14"
                   TextColor="LightGray"/>
        </VerticalStackLayout>

        <!-- Scrollable content -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="15">

                <!-- Status / feedback message -->
                <Label Text="{Binding StatusMessage}"
                       IsVisible="{Binding HasStatusMessage}"
                       HorizontalOptions="Center"
                       TextColor="Orange"
                       FontSize="14"
                       FontAttributes="Bold"/>

                <ActivityIndicator IsVisible="{Binding IsProcessing}"
                                   IsRunning="{Binding IsProcessing}"
                                   Color="White"
                                   HorizontalOptions="Center"/>

                <!-- â”€â”€ STEP 1: Verify current password â”€â”€ -->
                <Frame IsVisible="{Binding IsStepOne}"
                       Padding="15"
                       BorderColor="#424242"
                       BackgroundColor="#252525"
                       CornerRadius="8"
                       HasShadow="False">
                    <VerticalStackLayout Spacing="14">

                        <Grid ColumnDefinitions="*,Auto">
                            <VerticalStackLayout Grid.Column="0" Spacing="4" VerticalOptions="Center">
                                <Label Text="Step 1 â€” Verify Your Identity"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="White"/>
                                <Label Text="Enter your current password to receive a verification code."
                                       FontSize="13"
                                       TextColor="LightGray"/>
                            </VerticalStackLayout>
                            <Label Grid.Column="1"
                                   Text="ðŸ”‘"
                                   FontSize="28"
                                   VerticalOptions="Center"/>
                        </Grid>

                        <Label Text="Current Password"
                               FontSize="12"
                               TextColor="Gray"/>

                        <Frame CornerRadius="5" Padding="0" BackgroundColor="#40444b" HasShadow="False">
                            <Entry Placeholder="Enter current password"
                                   PlaceholderColor="#72767d"
                                   TextColor="White"
                                   BackgroundColor="Transparent"
                                   IsPassword="True"
                                   Text="{Binding CurrentPassword}"/>
                        </Frame>

                        <Label FontSize="12"
                               TextColor="LightGray">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="A 6-digit verification code will be sent to "/>
                                    <Span Text="{Binding UserEmail}"
                                          FontAttributes="Bold"
                                          TextColor="White"/>
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>

                        <Button Text="Send Verification Code"
                                Command="{Binding RequestCodeCommand}"
                                BackgroundColor="#7289DA"
                                TextColor="White"
                                CornerRadius="6"/>

                    </VerticalStackLayout>
                </Frame>

                <!-- â”€â”€ STEP 2: Enter code + new password â”€â”€ -->
                <Frame IsVisible="{Binding IsStepTwo}"
                       Padding="15"
                       BorderColor="#7289DA"
                       BackgroundColor="#252525"
                       CornerRadius="8"
                       HasShadow="False">
                    <VerticalStackLayout Spacing="14">

                        <Grid ColumnDefinitions="*,Auto">
                            <VerticalStackLayout Grid.Column="0" Spacing="4" VerticalOptions="Center">
                                <Label Text="Step 2 â€” Enter Code &amp; New Password"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="White"/>
                                <Label Text="Check your email for the verification code, then choose a new password."
                                       FontSize="13"
                                       TextColor="LightGray"/>
                            </VerticalStackLayout>
                            <Label Grid.Column="1"
                                   Text="âœ‰ï¸"
                                   FontSize="28"
                                   VerticalOptions="Center"/>
                        </Grid>

                        <!-- Simulated email code (dev helper) -->
                        <Frame IsVisible="{Binding HasSimulatedCode}"
                               Padding="12"
                               BackgroundColor="#1E1E1E"
                               CornerRadius="6"
                               HasShadow="False"
                               BorderColor="#555">
                            <VerticalStackLayout Spacing="4">
                                <Label Text="ðŸ“§ Simulated Email Code (dev preview)"
                                       FontSize="11"
                                       TextColor="Gray"/>
                                <Label Text="{Binding SimulatedCode}"
                                       FontSize="22"
                                       FontAttributes="Bold"
                                       TextColor="#43B581"
                                       HorizontalOptions="Center"
                                       LetterSpacing="4"/>
                                <Label Text="This code expires in 15 minutes."
                                       FontSize="11"
                                       TextColor="Gray"
                                       HorizontalOptions="Center"/>
                            </VerticalStackLayout>
                        </Frame>

                        <Label Text="Verification Code"
                               FontSize="12"
                               TextColor="Gray"/>

                        <Frame CornerRadius="5" Padding="0" BackgroundColor="#40444b" HasShadow="False">
                            <Entry Placeholder="6-digit code"
                                   PlaceholderColor="#72767d"
                                   TextColor="White"
                                   BackgroundColor="Transparent"
                                   Keyboard="Numeric"
                                   MaxLength="6"
                                   Text="{Binding VerificationCode}"/>
                        </Frame>

                        <Label Text="New Password"
                               FontSize="12"
                               TextColor="Gray"
                               Margin="0,8,0,0"/>

                        <Frame CornerRadius="5" Padding="0" BackgroundColor="#40444b" HasShadow="False">
                            <Entry Placeholder="New password (8+ characters)"
                                   PlaceholderColor="#72767d"
                                   TextColor="White"
                                   BackgroundColor="Transparent"
                                   IsPassword="True"
                                   Text="{Binding NewPassword}"/>
                        </Frame>

                        <Label Text="Confirm New Password"
                               FontSize="12"
                               TextColor="Gray"/>

                        <Frame CornerRadius="5" Padding="0" BackgroundColor="#40444b" HasShadow="False">
                            <Entry Placeholder="Repeat new password"
                                   PlaceholderColor="#72767d"
                                   TextColor="White"
                                   BackgroundColor="Transparent"
                                   IsPassword="True"
                                   Text="{Binding ConfirmPassword}"/>
                        </Frame>

                        <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                            <Button Grid.Column="0"
                                    Text="Change Password"
                                    Command="{Binding ChangePasswordCommand}"
                                    BackgroundColor="#43B581"
                                    TextColor="White"
                                    CornerRadius="6"/>
                            <Button Grid.Column="1"
                                    Text="Cancel"
                                    Command="{Binding CancelCommand}"
                                    BackgroundColor="#72767d"
                                    TextColor="White"
                                    CornerRadius="6"/>
                        </Grid>

                    </VerticalStackLayout>
                </Frame>

                <!-- â”€â”€ COMPLETE â”€â”€ -->
                <Frame IsVisible="{Binding IsComplete}"
                       Padding="15"
                       BorderColor="#43B581"
                       BackgroundColor="#252525"
                       CornerRadius="8"
                       HasShadow="False">
                    <VerticalStackLayout Spacing="14" HorizontalOptions="Center">

                        <Label Text="âœ…"
                               FontSize="48"
                               HorizontalOptions="Center"/>

                        <Label Text="Password Changed Successfully"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="White"
                               HorizontalOptions="Center"/>

                        <Label Text="Your password has been updated. Use your new password the next time you log in."
                               FontSize="13"
                               TextColor="LightGray"
                               HorizontalTextAlignment="Center"/>

                        <Button Text="Change Another Password"
                                Command="{Binding StartOverCommand}"
                                BackgroundColor="#7289DA"
                                TextColor="White"
                                CornerRadius="6"
                                HorizontalOptions="Center"/>

                    </VerticalStackLayout>
                </Frame>

            </VerticalStackLayout>
        </ScrollView>

    </Grid>
</ContentView>
