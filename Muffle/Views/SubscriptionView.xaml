<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Muffle.ViewModels"
             xmlns:models="clr-namespace:Muffle.Data.Models;assembly=Muffle.Data"
             x:Class="Muffle.Views.SubscriptionView"
             x:DataType="viewmodels:SubscriptionViewModel"
             BackgroundColor="#303030">

    <ScrollView>
        <VerticalStackLayout Padding="24" Spacing="20">

            <!-- Header -->
            <VerticalStackLayout Spacing="6">
                <Label Text="Muffle Premium"
                       FontSize="26"
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalOptions="Center"/>
                <Label Text="Unlock enhanced features and support development"
                       FontSize="13"
                       TextColor="LightGray"
                       HorizontalOptions="Center"/>
            </VerticalStackLayout>

            <!-- Current Plan Banner -->
            <Frame BackgroundColor="#252525"
                   BorderColor="#424242"
                   CornerRadius="10"
                   Padding="16"
                   HasShadow="False">
                <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
                    <VerticalStackLayout Grid.Column="0" Spacing="4">
                        <Label Text="Current Plan" FontSize="12" TextColor="LightGray"/>
                        <Label Text="{Binding CurrentTierLabel}"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="{Binding CurrentTierColor}"/>
                        <Label Text="{Binding ExpiryText}"
                               FontSize="12"
                               TextColor="Gray"/>
                    </VerticalStackLayout>
                    <Button Grid.Column="1"
                            Text="Cancel Plan"
                            IsVisible="{Binding HasActiveSubscription}"
                            Command="{Binding CancelCommand}"
                            BackgroundColor="#F04747"
                            TextColor="White"
                            CornerRadius="6"
                            Padding="14,8"
                            VerticalOptions="Center"/>
                </Grid>
            </Frame>

            <!-- Loading -->
            <ActivityIndicator IsVisible="{Binding IsLoading}"
                               IsRunning="{Binding IsLoading}"
                               Color="White"
                               HorizontalOptions="Center"/>

            <!-- Status Message -->
            <Frame IsVisible="{Binding HasStatusMessage}"
                   BackgroundColor="#3A3A3A"
                   BorderColor="#555"
                   CornerRadius="6"
                   Padding="12,8"
                   HasShadow="False">
                <Label Text="{Binding StatusMessage}"
                       TextColor="LightGreen"
                       FontSize="13"
                       HorizontalOptions="Center"/>
            </Frame>

            <!-- Tier Cards -->
            <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12">

                <!-- Free Card -->
                <Frame Grid.Column="0"
                       BackgroundColor="{Binding IsOnFree, Converter={StaticResource BoolToSelectedBgConverter}}"
                       BorderColor="{Binding IsOnFree, Converter={StaticResource BoolToSelectedBorderConverter}}"
                       CornerRadius="10"
                       Padding="14"
                       HasShadow="False">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Free" FontSize="18" FontAttributes="Bold" TextColor="#43B581" HorizontalOptions="Center"/>
                        <Label Text="$0" FontSize="26" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center"/>
                        <Label Text="forever" FontSize="11" TextColor="Gray" HorizontalOptions="Center"/>
                        <BoxView HeightRequest="1" BackgroundColor="#424242"/>
                        <Label Text="Basic messaging" FontSize="12" TextColor="LightGray"/>
                        <Label Text="Voice &amp; video calls" FontSize="12" TextColor="LightGray"/>
                        <Label Text="720p video quality" FontSize="12" TextColor="LightGray"/>
                        <Label Text="8 MB uploads" FontSize="12" TextColor="LightGray"/>
                        <Label Text="5 friend groups" FontSize="12" TextColor="LightGray"/>
                        <Label Text="Current Plan"
                               IsVisible="{Binding IsOnFree}"
                               TextColor="#43B581"
                               FontSize="12"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Premium Card -->
                <Frame Grid.Column="1"
                       BackgroundColor="{Binding IsOnPremium, Converter={StaticResource BoolToSelectedBgConverter}}"
                       BorderColor="#7289DA"
                       CornerRadius="10"
                       Padding="14"
                       HasShadow="False">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Premium" FontSize="18" FontAttributes="Bold" TextColor="#7289DA" HorizontalOptions="Center"/>
                        <Label Text="$4.99" FontSize="26" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center"/>
                        <Label Text="per month" FontSize="11" TextColor="Gray" HorizontalOptions="Center"/>
                        <BoxView HeightRequest="1" BackgroundColor="#424242"/>
                        <Label Text="1080p HD video" FontSize="12" TextColor="LightGray"/>
                        <Label Text="50 MB uploads" FontSize="12" TextColor="LightGray"/>
                        <Label Text="25 friend groups" FontSize="12" TextColor="LightGray"/>
                        <Label Text="Custom emoji" FontSize="12" TextColor="LightGray"/>
                        <Label Text="Animated avatars" FontSize="12" TextColor="LightGray"/>
                        <Label Text="2 server boosts/mo" FontSize="12" TextColor="LightGray"/>
                        <Button Text="{Binding IsOnPremium, Converter={StaticResource BoolToCurrentPlanTextConverter}}"
                                Command="{Binding SubscribePremiumCommand}"
                                IsEnabled="{Binding IsOnPremium, Converter={StaticResource InverseBoolConverter}}"
                                BackgroundColor="#7289DA"
                                TextColor="White"
                                CornerRadius="6"
                                Padding="0,10"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Premium+ Card -->
                <Frame Grid.Column="2"
                       BackgroundColor="{Binding IsOnPremiumPlus, Converter={StaticResource BoolToSelectedBgConverter}}"
                       BorderColor="#F39C12"
                       CornerRadius="10"
                       Padding="14"
                       HasShadow="False">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Premium+" FontSize="18" FontAttributes="Bold" TextColor="#F39C12" HorizontalOptions="Center"/>
                        <Label Text="$9.99" FontSize="26" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center"/>
                        <Label Text="per month" FontSize="11" TextColor="Gray" HorizontalOptions="Center"/>
                        <BoxView HeightRequest="1" BackgroundColor="#424242"/>
                        <Label Text="4K Ultra HD video" FontSize="12" TextColor="LightGray"/>
                        <Label Text="100 MB uploads" FontSize="12" TextColor="LightGray"/>
                        <Label Text="100 friend groups" FontSize="12" TextColor="LightGray"/>
                        <Label Text="All Premium perks" FontSize="12" TextColor="LightGray"/>
                        <Label Text="5 server boosts/mo" FontSize="12" TextColor="LightGray"/>
                        <Label Text="Priority support" FontSize="12" TextColor="LightGray"/>
                        <Label Text="Early feature access" FontSize="12" TextColor="LightGray"/>
                        <Button Text="{Binding IsOnPremiumPlus, Converter={StaticResource BoolToCurrentPlanTextConverter}}"
                                Command="{Binding SubscribePremiumPlusCommand}"
                                IsEnabled="{Binding IsOnPremiumPlus, Converter={StaticResource InverseBoolConverter}}"
                                BackgroundColor="#F39C12"
                                TextColor="White"
                                CornerRadius="6"
                                Padding="0,10"/>
                    </VerticalStackLayout>
                </Frame>

            </Grid>

            <!-- Feature Comparison Table -->
            <VerticalStackLayout Spacing="0">
                <Label Text="Feature Comparison"
                       FontSize="17"
                       FontAttributes="Bold"
                       TextColor="White"
                       Margin="0,10,0,10"/>

                <!-- Table Header -->
                <Grid ColumnDefinitions="3*,2*,2*,2*"
                      BackgroundColor="#252525"
                      Padding="12,10">
                    <Label Grid.Column="0" Text="Feature" FontSize="12" FontAttributes="Bold" TextColor="LightGray"/>
                    <Label Grid.Column="1" Text="Free" FontSize="12" FontAttributes="Bold" TextColor="#43B581" HorizontalOptions="Center"/>
                    <Label Grid.Column="2" Text="Premium" FontSize="12" FontAttributes="Bold" TextColor="#7289DA" HorizontalOptions="Center"/>
                    <Label Grid.Column="3" Text="Premium+" FontSize="12" FontAttributes="Bold" TextColor="#F39C12" HorizontalOptions="Center"/>
                </Grid>

                <CollectionView ItemsSource="{Binding Features}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:SubscriptionFeature">
                            <Grid ColumnDefinitions="3*,2*,2*,2*"
                                  Padding="12,9"
                                  BackgroundColor="#2A2A2A">
                                <Grid.Triggers>
                                    <DataTrigger TargetType="Grid" Binding="{Binding .}" Value="{x:Null}">
                                        <Setter Property="BackgroundColor" Value="#2A2A2A"/>
                                    </DataTrigger>
                                </Grid.Triggers>
                                <Label Grid.Column="0" Text="{Binding Name}" FontSize="12" TextColor="White" VerticalOptions="Center"/>
                                <Label Grid.Column="1" Text="{Binding FreeValue}" FontSize="12" TextColor="LightGray" HorizontalOptions="Center" VerticalOptions="Center"/>
                                <Label Grid.Column="2" Text="{Binding PremiumValue}" FontSize="12" TextColor="LightGray" HorizontalOptions="Center" VerticalOptions="Center"/>
                                <Label Grid.Column="3" Text="{Binding PremiumPlusValue}" FontSize="12" TextColor="LightGray" HorizontalOptions="Center" VerticalOptions="Center"/>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>

            <!-- Disclaimer -->
            <Label Text="&#x26A0; This is a simulated subscription system for demonstration purposes. No real payments are processed."
                   FontSize="11"
                   TextColor="Gray"
                   HorizontalOptions="Center"
                   HorizontalTextAlignment="Center"
                   Margin="0,8,0,0"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentView>
