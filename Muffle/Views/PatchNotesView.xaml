<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Muffle.ViewModels"
             xmlns:models="clr-namespace:Muffle.Data.Models;assembly=Muffle.Data"
             xmlns:converters="clr-namespace:Muffle.Converters"
             x:Class="Muffle.Views.PatchNotesView"
             x:DataType="viewmodels:PatchNotesViewModel"
             BackgroundColor="#303030">

    <ContentView.Resources>
        <converters:EntryTypeToBadgeColorConverter x:Key="EntryTypeToBadgeColorConverter" />
    </ContentView.Resources>

    <Grid RowDefinitions="Auto,*" Padding="20" RowSpacing="15">

        <!-- Header -->
        <VerticalStackLayout Grid.Row="0" Spacing="10">
            <Label Text="Patch Notes"
                   FontSize="24"
                   FontAttributes="Bold"
                   TextColor="White"/>
            <Label Text="What's new in Muffle â€” full version history and release notes"
                   FontSize="14"
                   TextColor="LightGray"/>
        </VerticalStackLayout>

        <!-- Patch Notes List -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="12">

                <!-- Empty state -->
                <Label Text="No patch notes available."
                       IsVisible="{Binding HasPatchNotes, Converter={StaticResource InverseBoolConverter}}"
                       HorizontalOptions="Center"
                       TextColor="Gray"
                       FontSize="14"
                       Margin="0,40,0,0"/>

                <!-- Notes -->
                <CollectionView ItemsSource="{Binding PatchNotes}"
                                IsVisible="{Binding HasPatchNotes}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:PatchNote">
                            <Frame Padding="15"
                                   Margin="0,0,0,10"
                                   BorderColor="#424242"
                                   BackgroundColor="#252525"
                                   CornerRadius="8"
                                   HasShadow="False">
                                <VerticalStackLayout Spacing="10">

                                    <!-- Version and date -->
                                    <Grid ColumnDefinitions="*,Auto">
                                        <Label Grid.Column="0"
                                               Text="{Binding Version}"
                                               FontSize="18"
                                               FontAttributes="Bold"
                                               TextColor="White"
                                               VerticalOptions="Center"/>
                                        <Label Grid.Column="1"
                                               Text="{Binding ReleaseDateDisplay}"
                                               FontSize="12"
                                               TextColor="Gray"
                                               VerticalOptions="Center"/>
                                    </Grid>

                                    <!-- Summary -->
                                    <Label Text="{Binding Summary}"
                                           FontSize="13"
                                           TextColor="LightGray"/>

                                    <!-- Divider -->
                                    <BoxView HeightRequest="1"
                                             Color="#424242"
                                             Margin="0,2,0,2"/>

                                    <!-- Entries -->
                                    <VerticalStackLayout Spacing="8"
                                                         BindableLayout.ItemsSource="{Binding Entries}">
                                        <BindableLayout.ItemTemplate>
                                            <DataTemplate x:DataType="models:PatchNoteEntry">
                                                <Grid ColumnDefinitions="68,*"
                                                      ColumnSpacing="10"
                                                      Margin="0,2,0,2">
                                                    <!-- Type badge -->
                                                    <Frame Grid.Column="0"
                                                           Padding="6,3"
                                                           CornerRadius="4"
                                                           HasShadow="False"
                                                           BackgroundColor="{Binding EntryType, Converter={StaticResource EntryTypeToBadgeColorConverter}}"
                                                           VerticalOptions="Center"
                                                           HorizontalOptions="Start">
                                                        <Label Text="{Binding EntryType}"
                                                               FontSize="10"
                                                               FontAttributes="Bold"
                                                               TextColor="White"
                                                               HorizontalOptions="Center"
                                                               VerticalOptions="Center"/>
                                                    </Frame>
                                                    <!-- Description -->
                                                    <Label Grid.Column="1"
                                                           Text="{Binding Description}"
                                                           FontSize="13"
                                                           TextColor="LightGray"
                                                           VerticalOptions="Center"/>
                                                </Grid>
                                            </DataTemplate>
                                        </BindableLayout.ItemTemplate>
                                    </VerticalStackLayout>

                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>

    </Grid>

</ContentView>
