<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Muffle.ViewModels"
             x:Class="Muffle.Views.ThemeSettingsView"
             x:DataType="viewmodels:ThemeSettingsViewModel"
             BackgroundColor="#303030">
    
    <Grid RowDefinitions="Auto,*" Padding="20" RowSpacing="15">
        
        <!-- Header -->
        <VerticalStackLayout Grid.Row="0" Spacing="10">
            <Label Text="Theme Settings" 
                   FontSize="24" 
                   FontAttributes="Bold" 
                   TextColor="White"/>
            <Label Text="Customize the look and feel of Muffle" 
                   FontSize="14" 
                   TextColor="LightGray"/>
        </VerticalStackLayout>

        <!-- Content Area -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="15">

                <!-- Status Message -->
                <Label Text="{Binding StatusMessage}" 
                       IsVisible="{Binding HasStatusMessage}"
                       HorizontalOptions="Center"
                       TextColor="Orange"
                       FontSize="14"
                       FontAttributes="Bold"/>

                <!-- Processing Indicator -->
                <ActivityIndicator IsVisible="{Binding IsProcessing}" 
                                 IsRunning="{Binding IsProcessing}"
                                 Color="White"
                                 HorizontalOptions="Center"/>

                <!-- Dark/Light Mode Toggle -->
                <Frame Padding="15" 
                       BorderColor="#424242"
                       BackgroundColor="#252525"
                       CornerRadius="8"
                       HasShadow="False">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Appearance" 
                               FontSize="16" 
                               FontAttributes="Bold"
                               TextColor="White"/>
                        <Label Text="Switch between dark and light mode" 
                               FontSize="12" 
                               TextColor="Gray"/>

                        <Grid ColumnDefinitions="*,Auto" Padding="0,10,0,10">
                            <Label Grid.Column="0"
                                   Text="{Binding ModeDisplayName}"
                                   FontSize="14"
                                   TextColor="White"
                                   VerticalOptions="Center"/>
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding IsDarkMode}"
                                    OnColor="#7289DA"
                                    ThumbColor="White"/>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Theme Selection -->
                <Frame Padding="15" 
                       BorderColor="#424242"
                       BackgroundColor="#252525"
                       CornerRadius="8"
                       HasShadow="False">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Theme" 
                               FontSize="16" 
                               FontAttributes="Bold"
                               TextColor="White"/>
                        <Label Text="Choose a theme preset" 
                               FontSize="12" 
                               TextColor="Gray"/>
                        <Label Text="{Binding SelectedTheme, StringFormat='Current: {0}'}" 
                               FontSize="13" 
                               TextColor="LightGray"
                               Margin="0,5,0,5"/>
                        
                        <CollectionView ItemsSource="{Binding AvailableThemes}"
                                      HeightRequest="50"
                                      ItemsLayout="HorizontalList">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="x:String">
                                    <Frame Padding="12,8" 
                                           Margin="4,0" 
                                           BorderColor="#424242"
                                           BackgroundColor="#1E1E1E"
                                           CornerRadius="4"
                                           HasShadow="False">
                                        <Frame.GestureRecognizers>
                                            <TapGestureRecognizer 
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:ThemeSettingsViewModel}}, Path=SelectThemeCommand}"
                                                CommandParameter="{Binding .}"/>
                                        </Frame.GestureRecognizers>
                                        <Label Text="{Binding .}" 
                                               FontSize="13" 
                                               TextColor="White"
                                               VerticalOptions="Center"
                                               HorizontalOptions="Center"/>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>

                <!-- Accent Color -->
                <Frame Padding="15" 
                       BorderColor="#424242"
                       BackgroundColor="#252525"
                       CornerRadius="8"
                       HasShadow="False">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Accent Color" 
                               FontSize="16" 
                               FontAttributes="Bold"
                               TextColor="White"/>
                        <Label Text="Choose your accent color for buttons and highlights" 
                               FontSize="12" 
                               TextColor="Gray"/>
                        <Label Text="{Binding SelectedAccentColorName, StringFormat='Current: {0}'}" 
                               FontSize="13" 
                               TextColor="LightGray"
                               Margin="0,5,0,5"/>

                        <CollectionView ItemsSource="{Binding AccentColorOptions}"
                                      HeightRequest="60">
                            <CollectionView.ItemsLayout>
                                <GridItemsLayout Orientation="Vertical" 
                                               Span="4" 
                                               HorizontalItemSpacing="8"
                                               VerticalItemSpacing="8"/>
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodels:AccentColorOption">
                                    <Frame Padding="8,6" 
                                           BorderColor="#424242"
                                           BackgroundColor="{Binding ColorHex}"
                                           CornerRadius="4"
                                           HasShadow="False"
                                           HeightRequest="40">
                                        <Frame.GestureRecognizers>
                                            <TapGestureRecognizer 
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:ThemeSettingsViewModel}}, Path=SelectAccentColorCommand}"
                                                CommandParameter="{Binding .}"/>
                                        </Frame.GestureRecognizers>
                                        <Label Text="{Binding Name}" 
                                               FontSize="11" 
                                               TextColor="White"
                                               VerticalOptions="Center"
                                               HorizontalOptions="Center"/>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>

                <!-- Save Theme Button -->
                <Button Text="Save Theme" 
                        Command="{Binding SaveThemeCommand}"
                        BackgroundColor="#43B581"
                        TextColor="White"
                        CornerRadius="4"
                        Padding="0,12"
                        IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"
                        Margin="0,5,0,20"/>

            </VerticalStackLayout>
        </ScrollView>
        
    </Grid>
</ContentView>
